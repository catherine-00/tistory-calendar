<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>í‹°ìŠ¤í† ë¦¬ í¬ìŠ¤íŒ… ìº˜ë¦°ë”</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 1rem; }

    /* âœ… ì—°ë„ ë²„íŠ¼ UI */
    .toolbar {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 0.8rem;
    }
    .year-btn {
      border: 1px solid #ddd;
      background: #fff;
      padding: 6px 10px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 13px;
    }
    .year-btn.active {
      border-color: #000;
      font-weight: 700;
    }

    .calendar-container {
      display: flex;
      gap: 1.2rem;
      overflow-x: auto;
      padding-bottom: 1rem;
      scroll-snap-type: x mandatory;
      width: 100%;
    }
    .month {
      flex: 0 0 auto;
      scroll-snap-align: start;
    }
    .month-name {
      font-weight: bold;
      font-size: 15px;
      margin-bottom: 0.5rem;
    }
    .weekdays {
      display: grid;
      font-size: 10px;
      grid-template-columns: repeat(7, 1fr);
      text-align: center;
      margin-bottom: 0.5rem;
    }
    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 4px;
    }
    .day {
      width: 20px;
      height: 20px;
      background-color: #fff;
      border: 1px solid #eee;
      border-radius: 4px;
      position: relative;
      text-align: center;
      line-height: 20px;
      font-size: 9px;
    }
    .today {
      outline: 2px solid #000;
      outline-offset: 2px;
    }
    .day:hover::after {
      content: attr(data-info);
      position: absolute;
      top: -28px;
      left: 50%;
      transform: translateX(-50%);
      background: #333;
      color: #fff;
      padding: 2px 6px;
      border-radius: 4px;
      font-size: 10px;
      white-space: nowrap;
      z-index: 10;
    }
    .posted {
      background: linear-gradient(120deg, #00ffff 20%, #ff0066 80%);
      outline: 2px solid #aaa;
      outline-offset: -2px;
    }
    .posted::after {
      content: "âœ“";
      color: white;
      font-weight: bold;
      font-size: 12px;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    }
  </style>
</head>
<body>

<h4 id="title">ğŸ“… í‹°ìŠ¤í† ë¦¬ í¬ìŠ¤íŒ… ìº˜ë¦°ë”</h4>

<!-- âœ… ì—°ë„ ë²„íŠ¼ -->
<div class="toolbar" id="toolbar">
  <button class="year-btn" data-year="2025">2025</button>
  <button class="year-btn" data-year="2026">2026</button>
</div>

<div class="calendar-container" id="calendarContainer"></div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const calendarContainer = document.getElementById('calendarContainer');
    const titleEl = document.getElementById('title');
    const toolbar = document.getElementById('toolbar');

    const koreaNow = new Date(new Date().toLocaleString("en-US", { timeZone: "Asia/Seoul" }));
    const today = koreaNow.toISOString().slice(0, 10); // YYYY-MM-DD

    // âœ… ì—°ë„ë³„ JSON ë§¤í•‘ (ì›í•˜ì‹œë©´ íŒŒì¼ëª… ê·œì¹™ì— ë§ì¶° ë°”ê¿”ë“œë¦´ê²Œìš”)
    const dataUrlByYear = {
      2025: "https://catherine-00.github.io/tistory-calendar/date/final_date.json",
      2026: "https://catherine-00.github.io/tistory-calendar/date/final_date.json",
    };

    function renderMonth(year, month) {
      const monthBlock = document.createElement('div');
      monthBlock.classList.add('month');
      monthBlock.innerHTML = `<div class="month-name">${month + 1}ì›”</div>`;

      const weekdays = ['ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† ','ì¼'];
      monthBlock.insertAdjacentHTML(
        'beforeend',
        '<div class="weekdays">' + weekdays.map(d => `<div>${d}</div>`).join('') + '</div>'
      );

      const grid = document.createElement('div');
      grid.classList.add('calendar-grid');

      const firstDay = new Date(year, month, 1);
      const offset = (firstDay.getDay() + 6) % 7; // ì›”ìš”ì¼ ì‹œì‘
      for (let i = 0; i < offset; i++) grid.innerHTML += '<div class="day"></div>';

      const days = new Date(year, month + 1, 0).getDate();
      for (let d = 1; d <= days; d++) {
        const dateStr = `${year}-${String(month + 1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
        grid.innerHTML += `<div class="day" data-date="${dateStr}">${d}</div>`;
      }

      monthBlock.appendChild(grid);
      calendarContainer.appendChild(monthBlock);
    }

    async function loadYear(year) {
      // UI ìƒíƒœ
      titleEl.textContent = `ğŸ“… ${year} í‹°ìŠ¤í† ë¦¬ í¬ìŠ¤íŒ… ìº˜ë¦°ë”`;
      toolbar.querySelectorAll('.year-btn').forEach(btn => {
        btn.classList.toggle('active', Number(btn.dataset.year) === Number(year));
      });

      // ìº˜ë¦°ë” ì´ˆê¸°í™” í›„ ë Œë”
      calendarContainer.innerHTML = '';
      for (let m = 0; m < 12; m++) renderMonth(year, m);

      // ë°ì´í„° URL í™•ì¸
      const url = dataUrlByYear[year];
      if (!url) {
        console.error("No data URL for year:", year);
        return;
      }

      try {
        const data = await fetch(url).then(r => r.json());

        // ë‚ ì§œ ì±„ìš°ê¸° + ì˜¤ëŠ˜ í‘œì‹œ(ì„ íƒëœ ì—°ë„ì™€ ì˜¤ëŠ˜ ì—°ë„ ì¼ì¹˜í•  ë•Œë§Œ)
        document.querySelectorAll('.day[data-date]').forEach(elem => {
          const date = elem.dataset.date;
          const count = data[date] || 0;

          if (count > 0) {
            elem.classList.add('posted');
            elem.setAttribute('data-info', `${count} post(s) on ${date}`);
          }

          if (date === today && today.startsWith(`${year}-`)) {
            elem.classList.add('today');
          }
        });

        // ì˜¤ëŠ˜ì´ ì„ íƒëœ ì—°ë„ì— ì†í•˜ë©´ í•´ë‹¹ ì›”ë¡œ ìŠ¤í¬ë¡¤
        if (today.startsWith(`${year}-`)) {
          const todayMonth = Array.from(document.querySelectorAll('.month')).find(monthEl => {
            return monthEl.querySelector('.day.today');
          });
          if (todayMonth) todayMonth.scrollIntoView({ behavior: 'smooth', inline: 'center' });
        }
      } catch (e) {
        console.error(e);
      }
    }

    // ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
    toolbar.addEventListener('click', (e) => {
      const btn = e.target.closest('.year-btn');
      if (!btn) return;
      loadYear(Number(btn.dataset.year));
    });

    // ì´ˆê¸° ì—°ë„: ì˜¤ëŠ˜ ê¸°ì¤€ ì—°ë„ê°€ ìˆìœ¼ë©´ ê·¸ ì—°ë„, ì—†ìœ¼ë©´ 2025
    const initialYear = dataUrlByYear[new Date(today).getFullYear()] ? new Date(today).getFullYear() : 2025;
    loadYear(initialYear);
  });
</script>

</body>
</html>
